services:
  ai-sandbox:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Host environment variables
        HOST_ARCH: ${HOST_ARCH}
        HOST_HOME: ${HOST_HOME}
        HOST_TZ: ${HOST_TZ}
        USERNAME: ${USERNAME}
        # Tool versions
        GIT_DELTA_VERSION: ${GIT_DELTA_VERSION}
        GO_VERSION: ${GO_VERSION}
        NVM_VERSION: ${NVM_VERSION}
        ZSH_IN_DOCKER_VERSION: ${ZSH_IN_DOCKER_VERSION}
        BUN_INSTALL_SH: ${BUN_INSTALL_SH}
        GO_TAR: ${GO_TAR}
        GIT_DELTA_DEB: ${GIT_DELTA_DEB}
        NVM_INSTALL_SH: ${NVM_INSTALL_SH}
        ZSH_IN_DOCKER_SH: ${ZSH_IN_DOCKER_SH}
        TOOL_CACHE_DIR: ${TOOL_CACHE_DIR}
    container_name: ai-sandbox
    stdin_open: true
    tty: true
    volumes:
      # Map local .claude to node user's home
      - ${HOST_HOME}/.claude:/home/${USERNAME}/.claude
      # v This does not work because claude (or a hook) tries to copy and overwrite it, which breaks things
      # - ${HOST_HOME}/.claude.json:/home/${USERNAME}/.claude.json
      # Map to same absolute path as host for plugin compatibility
      - ${HOST_HOME}/.claude-mem:/home/${USERNAME}/.claude-mem
      # Workspace for your projects
      - ${HOST_HOME}/playground:/home/${USERNAME}/workspace
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
