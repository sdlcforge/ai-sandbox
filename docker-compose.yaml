services:
  ai-sandbox:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Host environment variables
        HOST_ARCH: ${HOST_ARCH}
        HOST_HOME: ${HOST_HOME}
        HOST_TZ: ${HOST_TZ}
        HOST_USER: ${HOST_USER}
        # Tool versions
        S6_NOARCH_TAR: ${S6_NOARCH_TAR}
        S6_ARCH_TAR: ${S6_ARCH_TAR}
        GIT_DELTA_VERSION: ${GIT_DELTA_VERSION}
        GO_VERSION: ${GO_VERSION}
        NVM_VERSION: ${NVM_VERSION}
        ZSH_IN_DOCKER_VERSION: ${ZSH_IN_DOCKER_VERSION}
        BUN_INSTALL_SH: ${BUN_INSTALL_SH}
        GO_TAR: ${GO_TAR}
        GIT_DELTA_DEB: ${GIT_DELTA_DEB}
        NVM_INSTALL_SH: ${NVM_INSTALL_SH}
        ZSH_IN_DOCKER_SH: ${ZSH_IN_DOCKER_SH}
        TOOL_CACHE_DIR: ${TOOL_CACHE_DIR}
        GIT_USER_NAME: ${GIT_USER_NAME}
        GIT_USER_EMAIL: ${GIT_USER_EMAIL}
        SSH_AUTH_SOCK: "${SSH_AUTH_SOCK}"
    container_name: ai-sandbox
    stdin_open: true
    tty: true
    volumes:
      # Map host directories to same absolute paths in container
      - ${HOST_HOME}/.claude:${HOST_HOME}/.claude
      - ${HOST_HOME}/.claude-mem:${HOST_HOME}/.claude-mem
      - ${HOST_HOME}/.local:${HOST_HOME}/.local
      - ${HOST_HOME}/playground:${HOST_HOME}/playground
      - ${SSH_AUTH_SOCK}:${SSH_AUTH_SOCK}
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    ports:
      - "37777:37777"
    dns:
      - 8.8.8.8
      - 8.8.4.4
    extra_hosts:
      - "host.docker.internal:host-gateway"
  